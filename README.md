## CPU 사용률 API

### 프로젝트 설정 ###

- Spring Boot 사용
- Gradle 사용
- Java 17 사용
---

### 데이터베이스 설정 ###

- 개발 및 테스트 : H2 DB 사용
- 운용 : Maria DB 사용
  
- application.yml
  - 로컬 포트 : 8080
  - 개발 및 테스트 : local
  - 운용 : prod
  
  - 애플리케이션 실행 시, Edit Configuration -> Active profiles : prod/local 선택에 따라
DB 서버 선택 가능
---
### 기능 요구 사항 ###
- 데이터 수집 및 저장
  - CPU 사용률 수집 : 일정 시간 동안 CPU 상태 변화를 알기 위해, 쓰레드를 1초동안 정지 후 수집 
  - 데이터 저장 : 스케줄러를 통해 1분마다, 사용률을 수집하여 현재 날짜 시간과 함께 1분마다 저장

- 데이터 조회 API
  - 분 단위 조회: 지정한 시간 구간의 분 단위 CPU 사용률을 조회합니다.
    - /api/cpu-usage/minutes   
    - 스케줄러를 통해 1분마다 데이터를 수집하고 저장하기 때문에 시작 날짜와, 끝나는 날짜를 받아 사이의 데이터를 조회하면 분 단위로 조회
  - 시 단위 조회: 지정한 날짜의 시 단위 CPU 최소/최대/평균 사용률을 조회합니다.
    - /api/cpu-usage/hours
    - 시작 날짜와 끝나는 날짜를 입력 받아, 시작 날짜는 자정으로, 끝나는 날짜는 당일 23시59분59초로 변경하여 데이터를 조회
    - 최소/최대/평균 사용률을 조회해야하므로 JPQL을 사용하여 쿼리를 작성
    - 생성자 표현식을 사용하여 조회 결과를 서비스 계층에서 파싱하지 않고, dto객체를 직접 생성하여 반환
    - 년,월,일,시간별로 데이터를 그룹화하고 정렬
  - 일 단위 조회: 지정한 날짜 구간의 일 단위 CPU 최소/최대/평균 사용률을 조회합니다.
    - /api/cpu-usage/days  
    - 시작 날짜와 끝나는 날짜를 입력 받아, 시작 날짜는 자정으로, 끝나는 날짜는 당일 23시59분59초로 변경하여 데이터를 조회
    - 최소/최대/평균 사용률을 조회해야하므로 JPQL을 사용하여 쿼리를 작성
    - 생성자 표현식을 사용하여 조회 결과를 서비스 계층에서 파싱하지 않고, dto객체를 직접 생성하여 반환
    - 년,월,일로 데이터를 그룹화하고 정렬
  - Swagger를 사용하여 API 문서화를 설정하세요.
    - http://localhost:8080/swagger-ui/ 입력 시, 문서 확인 가능
    - 분 단위 API : 최근 1주 데이터 제공
    - 시 단위 API : 최근 3달 데이터 제공
    - 일 단위 API : 최근 1년 데이터 제공
---
### 예외 처리 ###
- 데이터 수집 실패 시 예외를 처리하고 로그를 남깁니다.
  - 쓰레드 오류 발생 시 로그 처리
  - 로그 처리 후, 글로벌 에러를 throw
  - RestControllerAdvice를 활용하여, 전역 에러 처리
  - 
- API 요청 시 잘못된 파라미터에 대한 예외를 처리합니다.
  - 잘못된 파라미터에 대한 오류 발생 시 로그 처리
  - RestControllerAdvice를 활용하여, 전역 에러 처리
---
### 테스트 ###
- 유닛 테스트: 서비스 계층과 데이터베이스 계층의 유닛 테스트를 작성하세요.
  - 서비스 계층
    - CPU 사용량 조회, 저장, 분/시간/일별 통계 조회 기능을 검증하며, 모의 CpuRepository를 사용하여 예상 결과와 실제 서비스 호출 결과를 비교
    - spock, groovy 사용하여 테스트 진행
    - 커버리지 체크 완료
  - 데이터베이스 계층
    - PU 사용량의 저장, 특정 시간 범위 내 모든 CPU 사용률 조회, 시간 및 일별 CPU 사용률 조회 기능을 검증 
    - CpuRepository를 모킹하여 예상 결과와 실제 서비스 호출 결과를 비교
    - spock, groovy 사용하여 테스트 진행 
    - 커버리지 체크 완료
- 통합 테스트: 컨트롤러 계층의 통합 테스트를 작성하세요.
  - 컨트롤러 계층 
    - MockMvc를 사용하여 HTTP GET 요청을 보내고, CpuService를 통해 예상되는 결과를 모의로 생성하여, API 응답이 성공적인지(상태 코드 200) 검증
    - spock, groovy 사용하여 테스트 진행
    - 커버리지 체크 완료

